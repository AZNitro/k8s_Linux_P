# FTP æœå‹™å®‰å…¨è¨­ç½®æŒ‡å— - ç¦ç”¨ vsftpd é˜²ç¯„å®‰å…¨é¢¨éšª

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Linux](https://img.shields.io/badge/Platform-Linux-blue.svg)](https://www.linux.org/)
[![Debian](https://img.shields.io/badge/Tested_on-Debian-red.svg)](https://www.debian.org/)
[![Security](https://img.shields.io/badge/Focus-Security-critical.svg)](https://www.debian.org/)

## ğŸ“‹ ç›®éŒ„

- [æ¦‚è¿°](#æ¦‚è¿°)
- [å®‰å…¨é¢¨éšªèªªæ˜](#å®‰å…¨é¢¨éšªèªªæ˜)
- [ç³»çµ±éœ€æ±‚](#ç³»çµ±éœ€æ±‚)
- [æª¢æŸ¥ FTP æœå‹™ç‹€æ…‹](#æª¢æŸ¥-ftp-æœå‹™ç‹€æ…‹)
- [ç¦ç”¨ vsftpd æœå‹™](#ç¦ç”¨-vsftpd-æœå‹™)
- [é©—è­‰å®‰å…¨è¨­ç½®](#é©—è­‰å®‰å…¨è¨­ç½®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [é‡æ–°å•Ÿç”¨æŒ‡å—](#é‡æ–°å•Ÿç”¨æŒ‡å—)
- [å®‰å…¨å»ºè­°](#å®‰å…¨å»ºè­°)
- [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
- [åƒè€ƒè³‡æ–™](#åƒè€ƒè³‡æ–™)

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—è©³ç´°èªªæ˜å¦‚ä½•åœ¨ Debian Linux ç³»çµ±ä¸Šå®‰å…¨åœ°ç¦ç”¨ vsftpd FTP æœå‹™ï¼Œä»¥é˜²ç¯„æ½›åœ¨çš„å®‰å…¨é¢¨éšªã€‚FTP æœå‹™åœ¨æœªç¶“é©ç•¶é…ç½®çš„æƒ…æ³ä¸‹å¯èƒ½æˆç‚ºç³»çµ±çš„å®‰å…¨æ¼æ´ï¼Œå› æ­¤å»ºè­°åœ¨ä¸éœ€è¦æ™‚å®Œå…¨ç¦ç”¨ã€‚

### å®‰å…¨ç†å¿µ

**é é˜²å‹æ–¼æ²»ç™‚** - é€šéå®Œå…¨ç¦ç”¨ä¸å¿…è¦çš„æœå‹™ä¾†æ¸›å°‘æ”»æ“Šé¢ï¼Œæ˜¯ç³»çµ±å®‰å…¨çš„æœ€ä½³å¯¦è¸ã€‚é™¤éä½ è¦–è³‡å®‰ç‚ºç„¡ç‰©ã€‚

## âš ï¸ å®‰å…¨é¢¨éšªèªªæ˜

### FTP æœå‹™å¸¸è¦‹å®‰å…¨å•é¡Œ

1. **æ˜æ–‡å‚³è¼¸**
   - FTP é»˜èªä½¿ç”¨æ˜æ–‡å‚³è¼¸
   - ç”¨æˆ¶åå’Œå¯†ç¢¼å®¹æ˜“è¢«ç«Šè½
   - æ•¸æ“šå‚³è¼¸ç„¡åŠ å¯†ä¿è­·

2. **èªè­‰å®‰å…¨**
   - å¼±å¯†ç¢¼å®¹æ˜“è¢«ç ´è§£
   - åŒ¿åè¨ªå•é¢¨éšª
   - æš´åŠ›ç ´è§£æ”»æ“Š

3. **æœå‹™æ¼æ´**
   - è»Ÿé«”æ¼æ´å¯èƒ½è¢«åˆ©ç”¨
   - é…ç½®éŒ¯èª¤å°è‡´æ¬Šé™æå‡
   - æœªæˆæ¬Šè¨ªå•é¢¨éšª

4. **è³‡æºæ¿«ç”¨**
   - å¯èƒ½è¢«ç”¨æ–¼éæ³•æ–‡ä»¶å‚³è¼¸
   - ä½”ç”¨ç³»çµ±è³‡æº
   - ç¶²è·¯é »å¯¬æ¿«ç”¨

   ### ç¸½çµå•é¡Œå¾ˆå¤š

## ğŸ’» ç³»çµ±éœ€æ±‚

- **ä½œæ¥­ç³»çµ±**: Debian 11/12 æˆ–ç›¸å®¹çš„ Linux ç™¼è¡Œç‰ˆ
- **æ¬Šé™**: éœ€è¦ sudo æˆ– root æ¬Šé™
- **å·²å®‰è£æœå‹™**: vsftpd å¥—ä»¶
- **ç¶²è·¯å·¥å…·**: systemctl, netstat, dpkg

## ğŸ” æª¢æŸ¥ FTP æœå‹™ç‹€æ…‹

### æª¢æŸ¥ vsftpd å®‰è£ç‹€æ…‹

```bash
# æª¢æŸ¥ vsftpd æ˜¯å¦å·²å®‰è£
dpkg -l | grep vsftpd

# é æœŸè¼¸å‡ºç¯„ä¾‹ï¼š
# ii  vsftpd    3.0.3-13+b2    amd64    lightweight, efficient FTP server
```

### æª¢æŸ¥æœå‹™é‹è¡Œç‹€æ…‹

```bash
# æª¢æŸ¥ vsftpd æœå‹™ç‹€æ…‹
sudo systemctl status vsftpd

# æª¢æŸ¥æ˜¯å¦é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
sudo systemctl is-enabled vsftpd

# æª¢æŸ¥ FTP ç«¯å£ç›£è½æƒ…æ³
sudo netstat -tlnp | grep :21
```

## ğŸ›¡ï¸ ç¦ç”¨ vsftpd æœå‹™

### æ­¥é©Ÿ 1: åœæ­¢ vsftpd æœå‹™

```bash
# ç«‹å³åœæ­¢ vsftpd æœå‹™
sudo systemctl stop vsftpd

# é©—è­‰æœå‹™å·²åœæ­¢
sudo systemctl status vsftpd
```

### æ­¥é©Ÿ 2: ç¦ç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•

```bash
# ç¦ç”¨ vsftpd é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
sudo systemctl disable vsftpd

# é æœŸè¼¸å‡ºï¼š
# Synchronizing state of vsftpd.service with SysV service script
# Executing: /lib/systemd/systemd-sysv-install disable vsftpd
```

### æ­¥é©Ÿ 3: å®Œå…¨å±è”½æœå‹™ï¼ˆå¼·åŒ–å®‰å…¨ï¼‰

```bash
# å±è”½ vsftpd æœå‹™ï¼Œé˜²æ­¢æ„å¤–å•Ÿå‹•
sudo systemctl mask vsftpd

# é æœŸè¼¸å‡ºï¼š
# Created symlink /etc/systemd/system/vsftpd.service â†’ /dev/null
```

**é‡è¦èªªæ˜**: `mask` å‘½ä»¤æœƒå‰µå»ºä¸€å€‹æŒ‡å‘ `/dev/null` çš„ç¬¦è™Ÿéˆæ¥ï¼Œç¢ºä¿æœå‹™ç„¡æ³•è¢«å•Ÿå‹•ï¼Œå³ä½¿å…¶ä»–ç¨‹åºæˆ–è…³æœ¬å˜—è©¦å•Ÿå‹•å®ƒã€‚

## âœ… é©—è­‰å®‰å…¨è¨­ç½®

### å»ºç«‹é©—è­‰è…³æœ¬

```bash
cat > ~/verify_ftp_security.sh << 'EOF'
#!/bin/bash

echo "=== FTP æœå‹™å®‰å…¨æª¢æŸ¥ ==="
echo "æª¢æŸ¥æ™‚é–“: $(date)"
echo

echo "1. vsftpd æœå‹™ç‹€æ…‹ï¼š"
systemctl is-active vsftpd 2>/dev/null || echo "æœå‹™æœªé‹è¡Œ"

echo "2. vsftpd é–‹æ©Ÿå•Ÿå‹•ç‹€æ…‹ï¼š"
systemctl is-enabled vsftpd 2>/dev/null || echo "å·²ç¦ç”¨é–‹æ©Ÿå•Ÿå‹•"

echo "3. æœå‹™å±è”½ç‹€æ…‹ï¼š"
if systemctl is-masked vsftpd >/dev/null 2>&1; then
    echo "âœ“ æœå‹™å·²è¢«å±è”½"
else
    echo "âœ— æœå‹™æœªè¢«å±è”½"
fi

echo "4. FTP ç«¯å£ç›£è½æª¢æŸ¥ï¼š"
if sudo netstat -tlnp | grep -q ":21"; then
    echo "âœ— ç™¼ç¾ FTP æœå‹™åœ¨ç«¯å£ 21 ä¸Šç›£è½"
    sudo netstat -tlnp | grep ":21"
else
    echo "âœ“ æ²’æœ‰ FTP æœå‹™åœ¨ç«¯å£ 21 ä¸Šç›£è½"
fi

echo "5. vsftpd ç¨‹åºæª¢æŸ¥ï¼š"
if pgrep -x vsftpd >/dev/null; then
    echo "âœ— ç™¼ç¾ vsftpd ç¨‹åºæ­£åœ¨é‹è¡Œ"
    pgrep -x vsftpd
else
    echo "âœ“ æ²’æœ‰ vsftpd ç¨‹åºåœ¨é‹è¡Œ"
fi

echo
echo "=== å®‰å…¨ç‹€æ…‹ç¸½çµ ==="
if systemctl is-masked vsftpd >/dev/null 2>&1 && ! pgrep -x vsftpd >/dev/null; then
    echo "âœ“ FTP æœå‹™å·²å®‰å…¨ç¦ç”¨"
else
    echo "âœ— FTP æœå‹™å¯èƒ½å­˜åœ¨å®‰å…¨é¢¨éšª"
fi
EOF

chmod +x ~/verify_ftp_security.sh
```

### åŸ·è¡Œé©—è­‰

```bash
# åŸ·è¡Œå®‰å…¨æª¢æŸ¥
~/verify_ftp_security.sh

# é æœŸè¼¸å‡ºæ‡‰é¡¯ç¤ºæ‰€æœ‰æª¢æŸ¥é …ç›®éƒ½é€šé
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ 1: æ¬Šé™ä¸è¶³

**ç—‡ç‹€**: åŸ·è¡Œ systemctl å‘½ä»¤æ™‚å‡ºç¾æ¬Šé™éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# ç¢ºä¿ä½¿ç”¨ sudo æ¬Šé™
sudo systemctl stop vsftpd
sudo systemctl disable vsftpd
sudo systemctl mask vsftpd

# æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦åœ¨ sudo ç¾¤çµ„ä¸­
groups $USER | grep sudo
```

### å¸¸è¦‹å•é¡Œ 2: æœå‹™ç„¡æ³•åœæ­¢

**ç—‡ç‹€**: systemctl stop å‘½ä»¤åŸ·è¡Œå¾Œæœå‹™ä»åœ¨é‹è¡Œ

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# å¼·åˆ¶çµ‚æ­¢ vsftpd ç¨‹åº
sudo pkill -f vsftpd

# æª¢æŸ¥æ˜¯å¦é‚„æœ‰ç›¸é—œç¨‹åº
pgrep -f vsftpd

# å¦‚æœä»æœ‰ç¨‹åºï¼Œä½¿ç”¨ SIGKILL
sudo pkill -9 -f vsftpd
```

### å¸¸è¦‹å•é¡Œ 3: æœå‹™è¢«å…¶ä»–ç¨‹åºé‡æ–°å•Ÿå‹•

**ç—‡ç‹€**: ç¦ç”¨å¾Œæœå‹™åˆè¢«é‡æ–°å•Ÿå‹•

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœå‹™ç®¡ç†å·¥å…·
sudo systemctl list-dependencies vsftpd

# æª¢æŸ¥ cron ä»»å‹™
sudo crontab -l | grep -i ftp
crontab -l | grep -i ftp

# æœå°‹ç³»çµ±ä¸­çš„ FTP ç›¸é—œè…³æœ¬
find /etc -name "*ftp*" -type f 2>/dev/null
```

## ğŸ”„ é‡æ–°å•Ÿç”¨æŒ‡å—

å¦‚æœå°‡ä¾†éœ€è¦é‡æ–°å•Ÿç”¨ FTP æœå‹™ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š

### å®‰å…¨é‡æ–°å•Ÿç”¨æ­¥é©Ÿ

```bash
# æ­¥é©Ÿ 1: å–æ¶ˆæœå‹™å±è”½
sudo systemctl unmask vsftpd

# æ­¥é©Ÿ 2: å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•ï¼ˆå¯é¸ï¼‰
sudo systemctl enable vsftpd

# æ­¥é©Ÿ 3: å•Ÿå‹•æœå‹™
sudo systemctl start vsftpd

# æ­¥é©Ÿ 4: é©—è­‰æœå‹™ç‹€æ…‹
sudo systemctl status vsftpd
```

### é‡æ–°å•Ÿç”¨å‰çš„å®‰å…¨é…ç½®

```bash
# å‚™ä»½åŸå§‹é…ç½®
sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.backup

# å»ºè­°çš„å®‰å…¨é…ç½®è¨­ç½®
sudo tee /etc/vsftpd.conf << EOF
# åŸºæœ¬è¨­ç½®
listen=YES
anonymous_enable=NO
local_enable=YES
write_enable=YES
local_umask=022

# å®‰å…¨è¨­ç½®
chroot_local_user=YES
allow_writeable_chroot=YES
secure_chroot_dir=/var/run/vsftpd/empty
pam_service_name=vsftpd
rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
ssl_enable=YES

# æ—¥èªŒè¨­ç½®
log_ftp_protocol=YES
xferlog_enable=YES
vsftpd_log_file=/var/log/vsftpd.log
EOF
```

## ğŸ”’ å®‰å…¨å»ºè­°

### 1. å®šæœŸå®‰å…¨æª¢æŸ¥

```bash
# å»ºç«‹å®šæœŸæª¢æŸ¥è…³æœ¬
cat > ~/weekly_security_check.sh << 'EOF'
#!/bin/bash

echo "=== æ¯é€±å®‰å…¨æª¢æŸ¥ - $(date) ==="

# æª¢æŸ¥æ„å¤–å•Ÿå‹•çš„ç¶²è·¯æœå‹™
echo "1. æª¢æŸ¥ç›£è½ç«¯å£ï¼š"
sudo netstat -tlnp | grep -E ":(21|20|22|23|25|53|80|443|993|995)"

# æª¢æŸ¥ FTP ç›¸é—œç¨‹åº
echo "2. æª¢æŸ¥ FTP ç¨‹åºï¼š"
pgrep -f ftp || echo "æ²’æœ‰ç™¼ç¾ FTP ç¨‹åº"

# æª¢æŸ¥ç³»çµ±æœå‹™ç‹€æ…‹
echo "3. æª¢æŸ¥è¢«å±è”½çš„æœå‹™ï¼š"
systemctl list-units --type=service --state=masked | grep -i ftp
EOF

chmod +x ~/weekly_security_check.sh
```

### 2. ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœéœ€è¦æ–‡ä»¶å‚³è¼¸åŠŸèƒ½ï¼Œå»ºè­°ä½¿ç”¨æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆï¼š

```bash
# å®‰è£ SFTP (SSH File Transfer Protocol)
sudo apt install openssh-server

# æˆ–ä½¿ç”¨ rsync é€²è¡Œæ–‡ä»¶åŒæ­¥
sudo apt install rsync

# æˆ–ä½¿ç”¨ SCP (Secure Copy Protocol)
# SCP æ˜¯ OpenSSH çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸å·²é è£
```

### 3. é˜²ç«ç‰†é…ç½®

```bash
# ç¢ºä¿é˜²ç«ç‰†é˜»æ­¢ FTP ç«¯å£
sudo ufw deny 20/tcp
sudo ufw deny 21/tcp

# æª¢æŸ¥é˜²ç«ç‰†ç‹€æ…‹
sudo ufw status
```

### 4. æ—¥èªŒç›£æ§

```bash
# ç›£æ§ç³»çµ±æ—¥èªŒä¸­çš„ FTP ç›¸é—œæ´»å‹•
sudo tail -f /var/log/syslog | grep -i ftp

# è¨­ç½®æ—¥èªŒè­¦å ±ï¼ˆå¯é¸ï¼‰
echo "è¨­ç½® logwatch ç›£æ§ FTP æ´»å‹•"
sudo apt install logwatch
```

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ç¦ç”¨ FTP æœå‹™æœƒå½±éŸ¿å…¶ä»–æœå‹™å—ï¼Ÿ

**A**: ä¸æœƒã€‚vsftpd æ˜¯ç¨ç«‹çš„ FTP æœå‹™ï¼Œç¦ç”¨å®ƒä¸æœƒå½±éŸ¿å…¶ä»–ç³»çµ±æœå‹™çš„æ­£å¸¸é‹è¡Œã€‚

### Q2: å¦‚ä½•ç¢ºä¿ FTP æœå‹™ä¸æœƒè¢«æ„å¤–é‡æ–°å•Ÿç”¨ï¼Ÿ

**A**: ä½¿ç”¨ `systemctl mask` å‘½ä»¤å¯ä»¥å®Œå…¨é˜»æ­¢æœå‹™è¢«å•Ÿå‹•ï¼š

```bash
# å±è”½æœå‹™
sudo systemctl mask vsftpd

# é©—è­‰å±è”½ç‹€æ…‹
systemctl is-masked vsftpd
```

### Q3: æ˜¯å¦éœ€è¦ç§»é™¤ vsftpd å¥—ä»¶ï¼Ÿ

**A**: ä¸ä¸€å®šéœ€è¦ã€‚å±è”½æœå‹™å·²ç¶“è¶³å¤ å®‰å…¨ï¼Œä½†å¦‚æœç¢ºå®šæ°¸é ä¸æœƒä½¿ç”¨ï¼Œå¯ä»¥å®Œå…¨ç§»é™¤ï¼š

```bash
# ç§»é™¤ vsftpd å¥—ä»¶
sudo apt remove --purge vsftpd
sudo apt autoremove
```

### Q4: å¦‚ä½•æª¢æŸ¥ç³»çµ±ä¸­æ˜¯å¦æœ‰å…¶ä»– FTP æœå‹™ï¼Ÿ

**A**: 

```bash
# æª¢æŸ¥å¸¸è¦‹çš„ FTP æœå‹™
systemctl list-units --type=service | grep -i ftp

# æª¢æŸ¥æ‰€æœ‰ç›£è½ç«¯å£
sudo netstat -tlnp | grep -E ":(20|21)"

# æª¢æŸ¥å·²å®‰è£çš„ FTP ç›¸é—œå¥—ä»¶
dpkg -l | grep -i ftp
```

### Q5: ç¦ç”¨ FTP æœå‹™å¾Œå¦‚ä½•é€²è¡Œæ–‡ä»¶å‚³è¼¸ï¼Ÿ

**A**: å»ºè­°ä½¿ç”¨æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆï¼š

```bash
# ä½¿ç”¨ SCP é€²è¡Œæ–‡ä»¶è¤‡è£½
scp file.txt user@remote-host:/path/to/destination/

# ä½¿ç”¨ rsync é€²è¡Œæ–‡ä»¶åŒæ­¥
rsync -avz /local/path/ user@remote-host:/remote/path/

# ä½¿ç”¨ SFTP é€²è¡Œäº’å‹•å¼æ–‡ä»¶å‚³è¼¸
sftp user@remote-host
```

## ğŸ“š åƒè€ƒè³‡æ–™

- [vsftpd å®˜æ–¹æ–‡ä»¶](https://security.appspot.com/vsftpd.html)
- [systemd æœå‹™ç®¡ç†](https://www.freedesktop.org/software/systemd/man/systemctl.html)
- [Linux å®‰å…¨æœ€ä½³å¯¦è¸](https://www.cisecurity.org/cis-benchmarks/)
- [NIST ç¶²è·¯å®‰å…¨æ¶æ§‹](https://www.nist.gov/cyberframework)

## ğŸ“ æ”¯æ´èˆ‡è²¢ç»

å¦‚æœæ‚¨åœ¨ä½¿ç”¨æœ¬æŒ‡å—æ™‚é‡åˆ°å•é¡Œï¼Œè«‹ï¼š

1. æª¢æŸ¥ [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ) ç« ç¯€
2. æŸ¥çœ‹ç³»çµ±æ—¥èªŒï¼š`sudo journalctl -u vsftpd`
3. åœ¨ GitHub Issues ä¸­æå‡ºå•é¡Œ

æ­¡è¿æäº¤ Pull Request ä¾†æ”¹å–„æœ¬æŒ‡å—ï¼

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆã€‚

---

**å…è²¬è²æ˜**: è«‹åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­å¯¦æ–½å‰ï¼Œå…ˆåœ¨æ¸¬è©¦ç’°å¢ƒä¸­é©—è­‰æ‰€æœ‰é…ç½®ã€‚ä½œè€…ä¸å°å› ä½¿ç”¨æœ¬æŒ‡å—è€Œé€ æˆçš„ä»»ä½•æå¤±æˆ–æå®³è² è²¬ã€‚

**æœ€å¾Œæ›´æ–°**: 2025å¹´6æœˆ17æ—¥  
**ç¶­è­·è€…**: Chen YuShen

---

## ğŸ¯ å¿«é€Ÿåƒè€ƒ

### ä¸€éµç¦ç”¨å‘½ä»¤
```bash
# å®Œæ•´ç¦ç”¨ vsftpd æœå‹™
sudo systemctl stop vsftpd && sudo systemctl disable vsftpd && sudo systemctl mask vsftpd
```

### é©—è­‰å‘½ä»¤
```bash
# å¿«é€Ÿé©—è­‰ FTP æœå‹™ç‹€æ…‹
sudo systemctl status vsftpd; sudo netstat -tlnp | grep :21
```

### ç·Šæ€¥é‡æ–°å•Ÿç”¨
```bash
# ç·Šæ€¥æƒ…æ³ä¸‹é‡æ–°å•Ÿç”¨ FTP æœå‹™
sudo systemctl unmask vsftpd && sudo systemctl start vsftpd
```
